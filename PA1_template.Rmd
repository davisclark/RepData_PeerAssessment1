---
title: "Reproducible Research: Peer Assessment 1"
author: "Davis Clark"
date: "Friday, April 17, 2015"
output: html_document
keep_md: true
---
```{r}
library(knitr)
knitr::opts_chunk$set(echo=TRUE, fig.path='figure/plot-', cache=TRUE)
```
###Prep working environment  

```{r message=FALSE}
library(lubridate)
library(ggplot2)
library(reshape2)
library(dplyr)
```

###Loading and preprocessing the data

Before we begin to analyze our data, it's essential that we process and prepare our dataset. Of course, we must read the data into our working environment.

The activity.zip file can be found at the following URL: 

```{r}
fileUrl<-"https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
```

Our code first scans the working directory, ensuring the file is not already
available. It then downloads the file if necessary, then reads the file into 
our working variable: activity.

```{r}
if(!("activity.zip" %in% list.files())) {
        download.file(url=fileUrl, destfile="activity.zip", mode="wb")
        unzip("activity.zip")
}

activity<-read.csv("activity.csv")
```


```{r, echo=FALSE}
activity$date<-ymd(activity$date)
```


### What is mean total number of steps taken per day?

```{r}
a<-melt(activity,measure.vars="steps")
b<-dcast(a, date ~ variable, sum)
```


```{r histogram with missing values, echo=FALSE}
qplot(steps, data=b, geom="histogram")
```

```{r}
mean(b$steps,na.rm=TRUE)
median(b$steps,na.rm=TRUE)
```

###What is the average daily activity pattern?

```{r}
c<-dcast(a, interval ~ variable, mean, na.rm=TRUE)
c<-arrange(c, interval)
```

```{r average steps, echo=FALSE}
qplot(c$interval,c$steps,geom="line")
c[(c$steps==max(c$steps)),]
```

###Imputing missing values
Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)

Missing value:
```{r}
sum(!complete.cases(activity))
```

```{r}
lookup<-c
f <- activity[(!complete.cases(activity)),]
row.names(f) <- NULL
f2 <- merge(f,lookup,by="interval")
names(f2)[4] <- "steps"
f2 <- arrange(select(f2, steps, date, interval), date, interval)
activity[(!complete.cases(activity)), ] <- f2
```

```{r}
a1<-melt(activity, measure.vars="steps")
d1<-dcast(a1, date ~ variable, sum)
```

```{r histogram without missing values, echo=FALSE}
qplot(steps, data=d1, geom="histogram")
mean(d1$steps)
median(d1$steps)
```

###Are there differences in activity patterns between weekdays and weekends?

```{r}
wdays <- mutate(activity, weekday = factor(weekdays(date) %in% c("Saturday", "Sunday"), labels=c("weekend", "weekday")))
```

